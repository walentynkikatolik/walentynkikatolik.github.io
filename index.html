<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="https://cdn-icons.flaticon.com/png/512/2448/premium/2448648.png?token=exp=1643206974~hmac=84cb176d488344e180f5f12422dd9e80">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comforter&family=Roboto+Condensed&display=swap" rel="stylesheet">
    <title>e-Walentynka | Wyślij walentynkę</title>
</head>

<body>
    <div id="header" class="header">
        <img class="logo" src="logo.png">
        <img class="logo2" src="logo2.png" >
    </div>
    <div class="content" id="content">
        <center>
        <h1>Stwórz swoją walentynkę!</h1>
        <div class="heart-creator">
            <div style="display: inline-block;">
                <div class="heart">
                    <div class="heart-content">
                        <h2 id="heart-title" class="heart-title">Tu wpisz tytuł</h2>
                        <h2 id="heart-text" class="heart-text">Tu wpisz tekst</h2>
                    </div>
                </div>
            </div>
            <div style="display: inline-block;">
                <div class="heart-options">
                    <input type="text" id="heart-title-input" name="heart-title-input" class="options-input" value="Tu wpisz tytuł" onChange="heartTitleEdit()" maxlength="45" placeholder="Tytuł"></input>
                    <input type="range" id="title-range" class="options-range" onchange="return rangeChange();">
                    <textarea id="heart-text-input" name="heart-text-input" class="options-textarea" onChange="heartTextEdit()" rows="6" maxrows="6" placeholder="Treść" maxlength="200">Tu wpisz tekst</textarea>
                    <input type="range" id="text-range" class="options-range" onchange="return rangeChange();">
                    <form onSubmit="return sendCard();">
                        <input type="text" id="receiver" name="receiver" class="sending-input" placeholder="Imię i nazwisko odbiorcy" required></input>
                        <input type="text" id="receiver-class" name="receiver-class" class="sending-input2" placeholder="Klasa" required></input>
                        </br>
                        <input type="text" id="sender" name="sender" class="sending-input3" placeholder="Twoje imię (możesz zostawić to pole puste)"></input>
                        </br>
                        <input type="submit" class="sending-submit" value="Wyślij">
                    </form>
                </div>
            </div>
        </div>
        </br>
        <p style="color: #ff0000;">Prosimy o niedodawanie emotikonów do tytułu ani treści walentynki</p>
        <p>Walentynki będą rozsyłane do odbiorców poprzez platformę Microsoft Teams w dniach 11-13.02.2022</p>
        </center>
    </div>
    <div class="success-page" id="success-page">
        <div>
            <center>
                <h3>Twoja walentynka została zapisana!</h3>
                <h4>Kartki będą rozsyłane w dniach 11-13.02.2022</h4>
                </br></br>
                <h4>Dziękujemy za udział w akcji! ❤️</h4>
                <div class="signature"></div>
            </center>
        </div>
    </div>

</body>



</html>

<script>
var jsondata = "";
rangeChange();
function heartTitleEdit() {
    document.getElementById("heart-title").innerHTML = document.getElementById("heart-title-input").value;
    return false;
}
function heartTextEdit() {
    heartText = document.getElementById("heart-text-input").value;
    heartText = heartText.replaceAll('\n', '</br>');
    document.getElementById("heart-text").innerHTML = heartText;
    return false;
}
function rangeChange() {
    titlefontsize = parseInt(document.getElementById("title-range").value);
    titlefontsize = titlefontsize / 100
    titlefontsize = titlefontsize * 80
    textfontsize = parseInt(document.getElementById("text-range").value);
    textfontsize = textfontsize / 100
    textfontsize = textfontsize * 40
    document.getElementById("heart-title").style.fontSize = titlefontsize+"px";
    document.getElementById("heart-text").style.fontSize = textfontsize+"px";
    //console.log(titlefontsize+"px, "+textfontsize+"px");
    return false;
}

function sendCard() {
    title = document.getElementById("heart-title").innerHTML;
    text = document.getElementById("heart-text").innerHTML;
    titlesize = document.getElementById("heart-title").style.fontSize;
    textsize = document.getElementById("heart-text").style.fontSize;
    receiver = document.getElementById("receiver").value
    receiverclass = document.getElementById("receiver-class").value
    sender = document.getElementById("sender").value
    carddata = title+";"+text+";"+titlesize+";"+textsize+";"+receiver+";"+receiverclass+";"+sender;

    document.getElementById("content").innerHTML = "</br></br><center><img src='loading.svg'></img><h1>Tworzenie walentynki...</h1></center>";
    let req = new XMLHttpRequest();

    req.onreadystatechange = () => {
    if (req.readyState == XMLHttpRequest.DONE) {
        //console.log(req.responseText);
        jsondata = req.responseText

        return sendCard2(carddata);
    }
    };

    req.open("GET", "https://api.jsonbin.io/v3/b/61f188b9bd6e744997ec42f6/latest", true);
    req.setRequestHeader("X-Master-Key", "$2b$10$8/p/2J/76YYKqYgYberDEO56NTs5a5k6wOlsRtqGlLJmvwdIAi75G");
    req.setRequestHeader("X-Bin-Meta", "false");
    req.send();

    return false;

}

function sendCard2(carddata) {
    jsondata = jsondata.substring(1);
    cardcode = Math.random() * (9999999999999999 - 1111111111111111) + 1111111111111111;
    //console.log("Kod walentynki: "+cardcode)
    newjsondata = '{"'+cardcode+'": "'+cardcode+';'+carddata+'",'+jsondata;
    //console.log(newjsondata);

    let req = new XMLHttpRequest();

    req.onreadystatechange = () => {
    if (req.readyState == XMLHttpRequest.DONE) {
        //console.log("WYSŁANO WALENTYNKĘ!")
        return success();
    }
    };

    req.open("PUT", "https://api.jsonbin.io/v3/b/61f188b9bd6e744997ec42f6", true);
    req.setRequestHeader("Content-Type", "application/json");
    req.setRequestHeader("X-Master-Key", "$2b$10$8/p/2J/76YYKqYgYberDEO56NTs5a5k6wOlsRtqGlLJmvwdIAi75G");
    req.send(newjsondata);

    return false;
}

function success() {
    document.getElementById("content").style.display = "none";
    document.getElementById("success-page").style.display = "inherit";
    document.getElementById("success-page").style.paddingTop = "150px";
    return false;
}




</script>